"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}window.onload=function(){var e=document.querySelector(".main-header--mobile"),t=document.querySelector(".main-header--list"),a=document.querySelectorAll('[data-parallax="true"]'),r=document.querySelectorAll('[data-smooth="true"]'),l=document.querySelectorAll('[data-toggle-main="true"]'),i=document.querySelectorAll('[data-toggle-alt="true"]'),o=document.querySelectorAll('[data-anchor-main="true"]'),n=document.querySelectorAll('[data-anchor-shop="true"]'),c=document.querySelector(".alt-nav"),d=document.querySelector("#shop"),s=(document.querySelectorAll(".product"),document.querySelectorAll(".product--more-info")),u=(document.querySelectorAll(".product--details"),document.querySelectorAll(".product--details"),document.querySelectorAll(".product--buy")),m=document.querySelectorAll(".product--color"),v=document.querySelectorAll(".product--img"),_=document.querySelectorAll(".details--img"),h=document.querySelector(".orders"),y=document.querySelector("#orders--form"),g=document.querySelector(".orders--list"),f=document.querySelectorAll(".orders--input__required"),p=document.querySelector(".main-header--orders"),S=document.querySelector(".main-header--amount"),b=document.querySelector(".main-header--buy"),q=document.querySelector(".orders--close"),L=document.querySelector(".price--amount"),A=document.querySelector("#cod"),w=document.querySelector(".orders--label__cod"),T=document.querySelector(".orders--overlay"),x=(document.querySelector(".order--deletes"),document.querySelector(".orders--submit"),document.querySelector(".orders--empty")),H=document.querySelector(".orders--error"),E=document.querySelector("#name"),M=document.querySelector("#surname"),k=document.querySelector("#phone"),D=(document.querySelectorAll(".modal"),document.querySelectorAll(".overlay")),O=document.querySelectorAll(".modal--btn"),C=document.querySelector(".thanks-for-order"),P=document.querySelector(".thanks-for-order--btn"),j=document.querySelector(".thanks-for-order--overlay");e.addEventListener("click",function(e){e.preventDefault(),t.classList.toggle("main-header--list__show"),t.classList.toggle("main-header--list__hide")});var I,R,W=(I=d,(R=new Object).topPos=I.offsetTop,R.botPos=d.offsetHeight+d.offsetTop,R),N=getPosition(o),$=getPosition(n);767<window.innerWidth&&(window.onscroll=function(){parallax(a,10);for(var e=window.pageYOffset||document.documentElement.scrollTop,t=0;t<l.length;t++)l[t].closest(".main-header--item").classList.remove("main-header--item__active");for(var r=0;r<N.length;r++)if(e>=N[r]-200&&e<N[r+1]-200?l[r].closest(".main-header--item").classList.add("main-header--item__active"):e>=N[N.length-1]-200&&l[N.length-1].closest(".main-header--item").classList.add("main-header--item__active"),e>=W.topPos-200&&e<W.botPos-400){c.classList.add("alt-nav__visible");for(var o=0;o<i.length;o++)i[o].classList.remove("alt-nav--item__active");for(var n=0;n<$.length;n++)e>=$[n]-400&&e<$[n+1]-400?i[n].classList.add("alt-nav--item__active"):e>=$[$.length-1]-400&&i[$.length-1].classList.add("alt-nav--item__active")}else(e<W.topPos-200||e>=W.botPos-400)&&c.classList.remove("alt-nav__visible")});for(var X=0;X<r.length;X++)r[X].addEventListener("click",function(e){e.preventDefault();var t=document.querySelector(this.getAttribute("href"));smoothScroll(t,10,60)});for(var J=0;J<m.length;J++)m[J].addEventListener("click",function(e){e.preventDefault();for(var t=_toConsumableArray(m).indexOf(this),r=v[t].closest(".product--more-info__img").querySelectorAll(".product--img__active"),o=m[t].closest(".product--colors").querySelectorAll(".product--color__active"),n=0;n<o.length;n++)o[n].classList.remove("product--color__active");if(m[t].classList.add("product--color__active"),!(1<v[t].closest(".product--more-info__img").querySelectorAll(".product--img").length))return!1;for(var a=0;a<r.length;a++)fadeOut(r[a],"product--img__active");fadeIn(v[t],"product--img__active")});for(var Y=0;Y<s.length;Y++)s[Y].addEventListener("click",function(e){var t=this.getAttribute("href"),r=document.querySelector(t),o=r.previousElementSibling,n=this.closest(".product").querySelector(".product--img__active"),a=_toConsumableArray(v).indexOf(n);G([r,o],["modal__show","overlay__show"],[r,o],["modal__hide","overlay__hide"]),r.querySelector('[tabindex="-1"]').setAttribute("tabindex","1");for(var l=0;l<_.length;l++)_[l].classList.remove("details--img__active");_[a].classList.add("details--img__active")});for(var z=0;z<D.length;z++)D[z].addEventListener("click",function(e){e.preventDefault();var t=this.nextElementSibling;if(!t.classList.contains("modal"))return!1;G([t,this],["modal__hide","overlay__hide"],[t,this],["modal__show","overlay__show"]),t.querySelector('[tabindex="1"]').setAttribute("tabindex","-1")});for(var B=0;B<O.length;B++)O[B].addEventListener("click",function(e){e.preventDefault();var t=this.closest(".modal"),r=t.previousElementSibling;t&&G([t,r],["modal__hide","overlay__hide"],[t,r],["modal__show","overlay__show"]),t.querySelector('[tabindex="1"]').setAttribute("tabindex","-1")});for(var F=0;F<u.length;F++)u[F].addEventListener("click",function(e){e.preventDefault();var r=this.closest(".shop--item").querySelector(".product--about").innerHTML,o=this.closest(".shop--item").querySelector(".product--price").innerHTML.replace(/\D+/g,""),n=(this.closest(".shop--item").querySelector(".product--img__active"),this.closest(".shop--item").querySelector(".product--img__active").getAttribute("src")),a=this.closest(".shop--item").querySelector(".product--img__active").getAttribute("alt"),l=this.closest(".shop--item").querySelector(".product--more-info").getAttribute("href"),i=l.replace(/\D+/g,""),c=this.closest(".shop--item").querySelector(".product--color__active").innerHTML,t=document.querySelectorAll(".order"),d=new Array,s=new Array,u=new Array,m=new Array;if(x.hidden=!0,b.classList.add("main-header--buy__rotate"),t.length){for(var v=0;v<t.length;v++)d[v]=t[v].querySelector(".order--name").innerHTML,s[v]=t[v].querySelector(".order--price").innerHTML.replace(/\D+/g,""),u[v]=t[v].querySelector(".order--img").getAttribute("src"),m[v]=t[v].querySelector(".order--amount").getAttribute("value");Q(!0,!0,!0,0);var _=d.indexOf(r),h=s.indexOf(o),y=u.indexOf(n);if(-1!==_&&-1!==h&&-1!==y){var f=+t[_].querySelector(".order--amount").value;f++,t[_].querySelector(".order--amount").setAttribute("value",f),Q(!0,!0,!1,0)}else p(),Q(!0,!0,!1,0)}else p(),L.innerHTML=o,setTimeout(function(){S.innerHTML=1},500);function p(){var e=' <a class="order--more-info" href="'.concat(l,'" data-number="').concat(i,'"> \n        <img class="order--img" src="').concat(n,'" alt="').concat(a,'" data-color="').concat(c,'">\n        </a>\n        <div class="order--info">\n        <p class="order--name">').concat(r,'</p>\n        <label class="order--label">\n        Количество:\n        <input type="number" min="1" max="10" class="order--amount" value="1">\n        </label>\n        <p class="order--price">').concat(o,' <span class="orders--currency">грн.</span></p>\n        <button class="order--delete">Удалить товар</button>\n        </div>'),t=document.createElement("li");t.className+=" orders--item order",t.innerHTML=e,g.appendChild(t)}});function G(e,t,r,o){for(var n=0;n<e.length;n++)e[n].classList.add(t[n]);for(var a=0;a<r.length;a++)r[a].classList.remove(o[a])}function K(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function Q(e,t,r){for(var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,n=document.querySelectorAll(".order"),a=new Array,l=new Array,i=0;i<n.length;i++)a[i]=n[i].querySelector(".order--amount").getAttribute("value"),l[i]=n[i].querySelector(".order--price").innerHTML.replace(/\D+/g,"");if(e&&t){for(var c=0,d=0,s=0;s<a.length;s++)c+=+a[s];r&&c++,setTimeout(function(){S.innerHTML=c.toString()},500);for(var u=0;u<l.length;u++)d+=l[u]*a[u];L.innerHTML=(d-d/100*o).toString()}}b.addEventListener("webkitAnimationEnd",function(e){b.classList.remove("main-header--buy__rotate")}),b.addEventListener("animationend",function(e){b.classList.remove("main-header--buy__rotate")}),document.addEventListener("input",function(e){e.target&&"order--amount"==e.target.classList[0]&&(e.target.setAttribute("value",e.target.value),Q(!0,!0,!1,0))}),p.addEventListener("click",function(e){e.preventDefault();var t=h.querySelectorAll('[tabindex="-1"]');G([h,T],["orders__show","overlay__show"],[h,T,q],["orders__hide","overlay__hide","orders--close__rotate"]);for(var r=0;r<t.length;r++)t[r].setAttribute("tabindex","1");767<window.innerWidth&&A.focus()}),q.addEventListener("click",function(e){e.preventDefault();var t=h.querySelectorAll('[tabindex="1"]');G([q,h,T],["orders--close__rotate","orders__hide","overlay__hide"],[h,T],["orders__show","overlay__show"]);for(var r=0;r<t.length;r++)t[r].setAttribute("tabindex","-1")}),T.addEventListener("click",function(e){e.preventDefault();var t=h.querySelectorAll('[tabindex="1"]');G([q,h,T],["orders--close__rotate","orders__hide","overlay__hide"],[h,T],["orders__show","overlay__show"]);for(var r=0;r<t.length;r++)t[r].setAttribute("tabindex","-1")}),A.addEventListener("input",function(r){var o,e,t,n;r.preventDefault(),e=function(e){o=e;for(var t=0;t<o.length;t++)if(r.target.closest(".orders--label__cod").classList.remove("orders--label__descending"),Q(!0,!0,!1,0),r.target.value==o[t]){r.target.closest(".orders--label__cod").classList.add("orders--label__descending"),Q(!0,!0,!1,10);break}},t=new XMLHttpRequest,n=new Array,t.open("POST","../php/promocods.php"),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=function(){if("4"==t.readyState&&200==t.status)n=t.responseText.replace(/\n/gi,"").split(","),e(n);else if("4"==t.readyState&&200!==t.status)return!1},t.send()}),document.addEventListener("click",function(e){if(e.target&&"order--img"==e.target.classList[0]){e.preventDefault();e.target.closest(".order");var t=e.target.getAttribute("src"),r=e.target.closest(".order--more-info").getAttribute("href"),o=document.querySelector(r),n=o.previousElementSibling,a=new Array,l=a.concat().indexOf(t);G([o,n],["modal__show","overlay__show"],[o,n],["modal__hide","overlay__hide"]),o.querySelector('[tabindex="-1"]').setAttribute("tabindex","1");for(var i=0;i<v.length;i++)a.push(v[i].getAttribute("src"));for(var c=0;c<_.length;c++)_[c].classList.remove("details--img__active");_[l].classList.add("details--img__active")}}),document.addEventListener("click",function(e){if(e.target&&"order--delete"==e.target.classList[0]){e.preventDefault();var t=e.target.closest(".order");fadeOut(t,"",40,function(e){e.parentNode.removeChild(e),Q(!0,!0,!1,0)},t)}}),y.addEventListener("submit",function(e){if(e.preventDefault(),!g.querySelector(".orders--item"))return x.hidden=!1;!function(e){for(var t=0;t<f.length;t++)f[t].value||(H.hidden=!1);E.value.match(/^[а-яФА-Я]+$/)||(H.hidden=!1);M.value.match(/^[а-яФА-Я]+$/)||(H.hidden=!1);k.value.match(/^\+380 \([0-9]{2}\) [0-9]{3}-[0-9]{2}-[0-9]{2}$/)?e():H.hidden=!1}(V)}),P.addEventListener("click",function(e){e.preventDefault(),K(g),y.reset(),L.innerHTML="0",S.innerHTML="0",w.classList.remove("orders--label__descending")}),j.addEventListener("click",function(e){e.preventDefault(),K(g),y.reset(),L.innerHTML="0",S.innerHTML="0",w.classList.remove("orders--label__descending")});for(var U=0;U<f.length;U++)f[U].addEventListener("input",function(e){e.preventDefault(),H.hidden=!0});function V(){for(var e=document.querySelectorAll(".orders--item"),t=new XMLHttpRequest,r=new Array,o=0;o<e.length;o++)r.push({name:e[o].querySelector(".order--name").innerHTML,amount:e[o].querySelector(".order--amount").value,price:e[o].querySelector(".order--price").innerHTML.replace(/\D+/g,""),number:e[o].querySelector("[data-number]").getAttribute("data-number"),color:e[o].querySelector("[data-color]").getAttribute("data-color")});var n=JSON.stringify({name:E.value.toString(),surname:M.value.toString(),phone:k.value.toString(),order:r,promocod:A.value.toString(),"promocod-descending":w.classList.contains("orders--label__descending"),summ:L.innerHTML});t.open("POST","../php/form.php"),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=function(){if(document.body.classList.add("wait"),"4"==t.readyState&&200==t.status&&"1"==t.responseText)document.body.classList.remove("wait"),G([C,j],["modal__show","overlay__show"],[C,j],["modal__hide","overlay__hide"]),C.querySelector('[tabindex="-1"]').setAttribute("tabindex","1");else if("4"==t.readyState&&200==t.status&&"1"!==t.responseText)switch(document.body.classList.remove("wait"),t.responseText){case"err_1":H.innerHTML="Заполните все поля формы",H.hidden=!1;break;case"err_2_1":H.innerHTML="Имя некоректно, исправьте ошибку",H.hidden=!1;break;case"err_2_2":H.innerHTML="Фамилия некоректна, исправьте ошибку",H.hidden=!1;break;case"err_2_3":H.innerHTML="Номер телефона некоректен, исправьте ошибку",H.hidden=!1}else"4"!=t.readyState&&200===t.status||(document.body.classList.remove("wait"),H.innerHTML="Ошибка отправки данных, повторите попытку позже",H.hidden=!1)},t.send(n)}};